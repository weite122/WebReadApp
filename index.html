<!DOCTYPE html>
<html ng-app="app">
<head>
	<title>Reader</title>
	<meta charset="utf-8">
	<script>
		var scale = 1 / window.devicePixelRatio // 1\2\3
		document.write(`
		  <meta name="viewport"
			content="initial-scale=${scale}, maximum-scale=${scale}, minimum-scale=${scale}, user-scalable=no"> 
		  `)
	  </script>
	  <script>
		var width = document.documentElement.clientWidth / window.devicePixelRatio
		var css = `
		html{
		  font-size: ${width / 10 * window.devicePixelRatio}px;
		}
		`
		document.write(`<style>${css}</style>`)
	  </script>
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div id="root" class="container">
    	<div class="m-artical-action">
    		<div class="artical-action-mid" id="action_mid"></div><!-- 用于中间点击唤醒上下边栏，命名时候加个mid有利于以后家需求 -->
    	</div>
        <div id="top-nav" class="top-nav" style="display: none;">
        	<div class="icon-back">
				<svg><use xlink:href="#icon-arrowleft"></use></svg>
			</div>
        	<div class="nav-title">返回书架</div>
        </div>
        <div id="fiction_chapter_title"></div>
        <div id="fiction_container" class="m-read-content">
            <h4>灵根育孕源流出</h4>
        	<p>诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
               诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
            </p>
            <p>诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
               诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
            </p>
            <p>诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
               诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
            </p>
            <p>诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
               诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
            </p>
            <p>诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
               诗曰：混沌未分天地乱，茫茫渺渺无人见。自从盘古破鸿蒙，开辟从兹清浊辨。
　　           覆载群生仰至仁，发明万物皆成善。欲知造化会元功，须看西游释厄传。
            </p>
        </div><!--命名要有实际意义，m代表模块,小说内容采用爬取-->
        <div class="m-button-bar">
        	<ul class="u-tab"><!--翻页按钮，按钮会有相应事件，所以li用id去标识-->
        		<li id="prev_button">上一章</li>
        		<li id="next_button">下一章</li>
        	</ul>
        </div>
        <div class="nav-pannel-bk font-container" style="display: none;"></div><!--因为背景是透明的，文字不透明，所以设置了一个平行的层，其实还可以用rgba()不会导致子元素变透明-->
        <div class="nav-pannel font-container" id="font-container" style="display: none;">
        	<div class="child-mod">
        		<span>字号</span>
        		<button id="large-button" class="font-size-button">大</button>
        		<button id="small-button" class="font-size-button">小</button>
        	</div>
        	<ul class="child-mod">
        		<span>背景</span>
        		<li class="bk-container-white">
        			<div class="bk-container-current"></div>
				</li>
        		<li class="bk-container-normal">
        			<div class="bk-container-current"></div>
				</li>
        		<li class="bk-container-gray">
        			<div class="bk-container-current"></div>
				</li>
        		<li class="bk-container-green">
        			<div class="bk-container-current"></div>
				</li>
        		<li class="bk-container-blue">
        			<div class="bk-container-current"></div>
				</li>
				<li class="bk-container-night">
        			<div class="bk-container-current"></div>
        		</li>
        	</ul>
        </div>
        <div class="bottom-nav-bk bottom_nav" style="display: none"></div>
        <div id="bottom-nav" class="bottom-nav bottom_nav" style="display: none;"><!--没有必要写在CSS里面，因为显隐都是通过JS改变-->
        	<div class="item" id="category-button">
        		<div class="item-wrap">
        			<div class="icon-category">                
                        <svg><use xlink:href="#icon-category"></use></svg>
                    </div>
        			<div class="category-title">目录</div>
        		</div>
        	</div>
        	<div class="item" id="font-button">
        		<div class="item-wrap">
        			<div class="icon-font">
                        <svg><use xlink:href="#icon-font"></use></svg>
                    </div>
        			<div class="font-title">字体</div>
        		</div>
        	</div>
        	<div class="item" id="night-button">
        		<div class="item-wrap" id="day_icon" style="display: none">
        			<div class="icon-day">
                        <svg><use xlink:href="#icon-sun"></use></svg>
                    </div>
        			<div class="day-title">白天</div>
        		</div>	
        		<div class="item-wrap" id="night_icon">
        			<div class="icon-night">
                        <svg><use xlink:href="#icon-night"></use></svg>
                    </div>
        			<div class="night-title">夜间</div>
        		</div>
        	</div> 	
        </div>
    	
    </div>
    <script src="lib/zepto.min.js"></script>
    <script src="//at.alicdn.com/t/font_466225_vg14m904y78hbyb9.js"></script>
		<script>
			window.jQuery = $;
		</script>
		<script src="js/jquery.base64.js"></script>
		<script src="js/jquery.jsonp.js"></script>
		<script type="text/javascript">
		    (function() {
		    	let Util = (function() {//封装方法
		    		/*该方法为H5在存储上提供了支持*/
		    		// 防止key被覆盖,防止同个域名下，他人误操作了localstorage,加了前缀
		    		let prefix = 'html5_reader_';
		    		let StorageGetter = function(key) {
		    			return localStorage.getItem(prefix + key);
		    		}
		    		let StorageSetter = function(key, val) {
		    			return localStorage.setItem(prefix + key, val);
		    		}

		    		return {//对象
		    			StorageGetter: StorageGetter,
		    			StorageSetter: StorageSetter
		    		}
		    	})();
		    	let Dom = {//声明常量以便多次引用,提高性能,多次使用的东西要提前调用且缓存，只用一次的没有必要
		    		top_nav:$('#top-nav'),
		    		bottom_nav: $('.bottom_nav'),
                    night_day_switch_button: $('#night-button'),
		    		font_container: $('.font-container'),
		    		font_button: $('#font-button'),
					color_button: $('.child-mod>li')
		    	}
                let Win = $(window)
                let Doc = $(document)
			    let RootContainer = $('#fiction_container')
				let initFontSize
				initFontSize = Util.StorageGetter('font-size',initFontSize)
				initFontSize = parseInt(initFontSize)
				
				if(!initFontSize){
					initFontSize = 14 * window.devicePixelRatio 
				}
				RootContainer.css('font-size',initFontSize)
				
		    	function main() {
		    		//todo 整个项目的入口函数
		    		EventHandler()
		    	}

		    	function ReaderModel() {
		    		//todo 这是一个接口--实现和阅读器相关的数据交互方法，ajax请求，跨域数据请求，所有和服务器相关的放在这里
		    	}
		    	function ReaderBaseFrame() {
		    		//todo 渲染基本的UI结构
		    	}

		    	function EventHandler() {
		    		//todo 交互的事件绑定
		    		//点击唤出上下边栏，click比touch,zepto tap好一点，因为click兼容想要在PC端访问移动端网站的用户
		    		$('#action_mid').click(function(){
		    			if (Dom.top_nav.css('display') === 'none') {
		    				Dom.bottom_nav.show()
		    				Dom.top_nav.show()
		    			} else {
		    				Dom.bottom_nav.hide()
		    				Dom.top_nav.hide()
                            Dom.font_container.hide()
							Dom.font_button.removeClass('active')
		    			}
		    		})

                    Dom.font_button.click(function(){
                        if(Dom.font_container.css('display') === 'none'){
                            Dom.font_container.show()
                            Dom.font_button.addClass('active')
                        } else {
                            Dom.font_container.hide()
                            Dom.font_button.removeClass('active')
                        }
                    })
                    $('#night-button').click(function(){
		    			if ($('#day_icon').css('display') === 'block') {
		    				$('#day_icon').css('display', 'none');
		    				$('#night_icon').css('display', 'block');
		    				$('body').css('background','#e9dfc7');		    				
		    			} else {
		    				$('#night_icon').css('display', 'none');
		    				$('#day_icon').css('display', 'block');
		    				$('body').css('background-color', '#000');
		    			}
                    })

		    		//背景颜色切换
					Dom.color_button.click(function(){
						let bodyColor = $(this).css('background-color')
						$('body').css('background', bodyColor);
					})

					$('#large-button').click(function(){
						if(initFontSize > 20 * window.devicePixelRatio){
							return
						}
						initFontSize += 1
						RootContainer.css('font-size',initFontSize)
						Util.StorageSetter('font-size',initFontSize)
					})
					$('#small-button').click(function(){
						if(initFontSize < 12 * window.devicePixelRatio){
							return
						}
						initFontSize -= 1
						RootContainer.css('font-size',initFontSize)
						Util.StorageSetter('font-size',initFontSize)
					})
                    Win.scroll(function(){
                        Dom.bottom_nav.hide()
		    			Dom.top_nav.hide()
                        Dom.font_container.hide()
                        Dom.font_button.removeClass('active')
                    })
		    	}
                main()
		    })();
			
		</script>
</body>
</html>